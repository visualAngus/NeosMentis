<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeosMentis - Home</title>
    <link rel="icon" href="/logo/logo_B.png">
    <link rel="stylesheet" href="css/new_main.css">
    <link rel="stylesheet" href="css/new_header.css">
    <link rel="stylesheet" href="css/new_home_page.css">
    <link rel="stylesheet" href="css/notif.css">


    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
</head>

<body>

    <div class="load_div">
        <div class="loader"></div>
    </div>

    <header>
        <div class="div_param_acc_tel">
            <div class="ligne"></div>
            <div class="ligne"></div>
            <div class="ligne"></div>
        </div>
        <div class="div_center_header">
            <img src="/logo/logo_N.png" alt="logo">
            <h1 >
                NeosMentis
            </h1>
        </div>

        <div class="div_header_r">
            <div class="div_acces_header">
                <div class="div_home_bnt">
                    <a href="/">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M17.0961 8.10703L10.8461 2.21016C10.843 2.20749 10.8402 2.20462 10.8375 2.20156C10.3607 1.76792 9.6323 1.76792 9.15547 2.20156L9.14688 2.21016L2.90391 8.10703C2.64644 8.34378 2.49995 8.67757 2.5 9.02734V16.25C2.5 16.9404 3.05964 17.5 3.75 17.5H7.5C8.19036 17.5 8.75 16.9404 8.75 16.25V12.5H11.25V16.25C11.25 16.9404 11.8096 17.5 12.5 17.5H16.25C16.9404 17.5 17.5 16.9404 17.5 16.25V9.02734C17.5001 8.67757 17.3536 8.34378 17.0961 8.10703ZM16.25 16.25H12.5V12.5C12.5 11.8096 11.9404 11.25 11.25 11.25H8.75C8.05964 11.25 7.5 11.8096 7.5 12.5V16.25H3.75V9.02734L3.75859 9.01953L10 3.125L16.2422 9.01797L16.2508 9.02578L16.25 16.25Z" />
                        </svg>
                    </a>
                    <a href="/project">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 48 48" fill="none">
                            <path
                                d="M22 8H8C6.93913 8 5.92172 8.42143 5.17157 9.17157C4.42143 9.92172 4 10.9391 4 12V40C4 41.0609 4.42143 42.0783 5.17157 42.8284C5.92172 43.5786 6.93913 44 8 44H36C37.0609 44 38.0783 43.5786 38.8284 42.8284C39.5786 42.0783 40 41.0609 40 40V26M37 5C37.7956 4.20435 38.8748 3.75736 40 3.75736C41.1252 3.75736 42.2044 4.20435 43 5C43.7956 5.79565 44.2426 6.87478 44.2426 8C44.2426 9.12522 43.7956 10.2044 43 11L24 30L16 32L18 24L37 5Z"
                                stroke="#1E1E1E" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </a>
                </div>
            </div>

            <div class="div_compte_header">
                <div class="div_profil_bnt">
                    <a href="/log?type=log">Login</a>
                    <a href="/log?type=register">Register</a>
                </div>
            </div>
        </div>

    </header>
    <main>
        <div class="div_titre_welcome">
            <h1></h1>
        </div>
        <div class="menu_choix">
            <button class="active_menu selected" id="all">All</button>
            <button class="active_menu" id="document">Documents</button>
            <button class="active_menu" id="event">Events</button>
            <button class="active_menu" id="project">Projects</button>
            <button class="active_menu collaborator_bnt_menu" id="collaborator">Collaborators</button>
        </div>

        <div class="div_research">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 20 20" fill="none">
                <path fill-rule="evenodd" clip-rule="evenodd"
                    d="M19.5306 18.4694L14.8366 13.7762C17.6629 10.383 17.3204 5.36693 14.0591 2.38935C10.7978 -0.588237 5.77134 -0.474001 2.64867 2.64867C-0.474001 5.77134 -0.588237 10.7978 2.38935 14.0591C5.36693 17.3204 10.383 17.6629 13.7762 14.8366L18.4694 19.5306C18.7624 19.8237 19.2376 19.8237 19.5306 19.5306C19.8237 19.2376 19.8237 18.7624 19.5306 18.4694ZM1.75 8.5C1.75 4.77208 4.77208 1.75 8.5 1.75C12.2279 1.75 15.25 4.77208 15.25 8.5C15.25 12.2279 12.2279 15.25 8.5 15.25C4.77379 15.2459 1.75413 12.2262 1.75 8.5Z" />
            </svg>
            <input type="text" class="input_research" placeholder="Are you looking for something ?">
        </div>
        <div class="titre_section">
            <h2>All documents</h2>
            <button class="add_doc">+</button>
        </div>
        <div class="div_documents">
        </div>
        <div class="titre_section">
            <h2>Upcoming events</h2>
            <button class="open_agenda">
                <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 32 32" fill="none">
                    <path d="M2 16H30M30 16L16 2M30 16L16 30" stroke="#1E1E1E" stroke-width="4" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
            </button>
        </div>
        <div class="div_events">
        </div>
        <div class="titre_section">
            <h2>Projects</h2>
            <button class="add_project">+</button>
        </div>
        <div class="div_projects">
            
        </div>

        <div class="titre_section">
            <h2>Collaborators</h2>
            <button class="add_colaborator">+</button>
            <button class="show_demande">Show requests</button>
        </div>
        <div class="div_collaborators">
            
        </div>
    </main>

</body>
<script src="js/notif.js"></script>
<script src="js/home_page_2.js"></script>
<script>

    // desactiver le clique droit de base
    document.addEventListener('contextmenu', event => event.preventDefault());

    function removeContextMenu() {
        const contextmenu = document.querySelector('.contextmenu');
        if (contextmenu) {
            contextmenu.remove();
        }
    }

    function contextmenu(x, y, id_doc) {
        let remove = false;
        removeContextMenu()

        const div = document.createElement('div');
        div.classList.add('contextmenu');
        const div1 = document.createElement('div');
        div1.className = 'contextmenu-item';
        div1.id = 'delete';
        div1.innerHTML = 'Delete';
        div1.addEventListener('click', () => {
            if (!remove) {
                div1.style.backgroundColor = 'var(--red-dark)';
                remove = true;
            } else {
                console.log('delete');
                remove_document(id_doc);
            }
        });

        const div2 = document.createElement('div');
        div2.className = 'contextmenu-item';
        div2.id = 'edit';
        div2.innerHTML = 'Edit';

        div2.addEventListener('click', () => {
            console.log('edit');
            document.location.href = `/editor?id=${id_doc}`;
        });

        div.appendChild(div1);
        div.appendChild(div2);


        div.style.left = `${x}px`;
        div.style.top = `${y}px`;

        document.body.appendChild(div);
    }

    // gÃ©rer le clique droit sur les divs
    document.addEventListener('mousedown', (e) => {
        if (e.button === 2) {
            removeContextMenu();
            if (e.target.closest('.document_div').classList.contains('document_div')) {
                contextmenu(e.clientX, e.clientY, e.target.closest('.document_div').id);
            }

        }
    });

    async function remove_document(id_doc) {
        const response = await fetch('/delete_document', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                id: id_doc
            })
        });
        const data = await response.json();
        if (data.success) {
            console.log('Document removed');
            document.querySelector(`.document_div[id="${id_doc}"]`).remove();
            removeContextMenu();
        } else {
            console.error('Error removing document:', data.message);
        }

    }

    // boucle d'update 

    // setInterval(async () => {
    //     // let active_menu = document.querySelector('.active_menu');
    //     // if (active_menu) {
    //     //     console.log('active_menu');
    //     //     active_menu.click();
    //     // }

    //     await have_request_collaborator().then(data => {
    //         if (data.requests.length == 0) {
    //             return;
    //         }
    //         list_notif_texte.push("Vous avez " + data.requests.length + " demande" + (data.requests.length > 1 ? "s" : "") + " de collaborateur" + (data.requests.length > 1 ? "s" : ""));
    //     });
    // }, 10000);



    let active_menu = document.querySelectorAll('.active_menu');

    let div_research = document.querySelector('.div_research');
    let div_documents = document.querySelector('.div_documents');
    let div_events = document.querySelector('.div_events');
    let div_projects = document.querySelector('.div_projects');
    let div_collaborators = document.querySelector('.div_collaborators');
    let titre_section = document.querySelectorAll('.titre_section');
    div_research.querySelector("input").focus();

    active_menu.forEach((element) => {
        element.addEventListener('click', async () => {
            active_menu.forEach((element) => {
                element.classList.remove('selected');
            });
            element.classList.add('selected');

            let type = element.id;
            if (type == 'all') {
                div_research.style.display = 'flex';
                div_documents.style.display = 'flex';
                div_events.style.display = 'flex';
                div_projects.style.display = 'flex';
                div_collaborators.style.display = 'flex';

                div_research.children[1].placeholder = "Are you looking for something ?";

                titre_section.forEach((element) => {
                    element.style.display = 'flex';
                });

            }else if (type == "document") {
                div_research.style.display = 'flex';
                div_documents.style.display = 'flex';
                div_events.style.display = 'none';
                div_projects.style.display = 'none';
                div_collaborators.style.display = 'none';

                div_research.children[1].placeholder = "You are looking for a document";

                titre_section.forEach((element) => {
                    element.style.display = 'none';
                });
                titre_section[0].style.display = 'flex';

            } else if (type == "event") {
                div_research.style.display = 'flex';
                div_documents.style.display = 'none';
                div_events.style.display = 'flex';
                div_projects.style.display = 'none';
                div_collaborators.style.display = 'none';

                div_research.children[1].placeholder = "You are looking for an event";

                titre_section.forEach((element) => {
                    element.style.display = 'none';
                });
                titre_section[1].style.display = 'flex';

            } else if (type == "project") {
                div_research.style.display = 'flex';
                div_documents.style.display = 'none';
                div_events.style.display = 'none';
                div_projects.style.display = 'flex';
                div_collaborators.style.display = 'none';

                div_research.children[1].placeholder = "You are looking for a project";

                titre_section.forEach((element) => {
                    element.style.display = 'none';
                });
                titre_section[2].style.display = 'flex';

            } else if (type == "collaborator") {
                div_research.style.display = 'flex';
                div_documents.style.display = 'none';
                div_events.style.display = 'none';
                div_projects.style.display = 'none';
                div_collaborators.style.display = 'flex';

                div_research.children[1].placeholder = "You are looking for a collaborator";

                titre_section.forEach((element) => {
                    element.style.display = 'none';
                });
                titre_section[3].style.display = 'flex';
            }
        });
    });

</script>

</html>